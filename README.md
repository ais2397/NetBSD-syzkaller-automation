# Sys2Syz

## Overview

Sys2Syz is a tool which can be used to convert Syscalls and other Ioctl calls to [syzkaller](https://github.com/google/syzkaller) representation. This tool is developed for the NetBSD Operating system and is done as a part of Google Summer of Code 2020 project with the NetBSD Foundation.

## Table of Contents 

- [Working](#working)
- [Installation and Usage](#installation)
- [Features](#features)
- [Results](#results)
- [TODO](#todo)
- [References](#references)

## Working
The tool supports generation of syzkaller descriptions for NetBSD device driver's ioctl calls. Following steps are involved:

- Extraction of all ioctl commands of a given device driver along with their arguments.
- Preprocessing of the device driver's files using compile_commands.json
- Generates descriptions for the calls and their arguments (builtin-types, arrays, pointers, structures and unions) using the XML files (XML files are generated by running c2xml on preprocessed device files).

## Installation
#### Prerequisites:
---
- [Bear](https://github.com/rizsotto/Bear) setup
- [NetBSD src](https://github.com/NetBSD/src) files

#### Build on Linux:
---
- Clone the repo
 ```shell
 git clone https://github.com/ais2397/sys2syz.git
 cd sys2syz
 ```
- Run the setup script

**Note:** This step requires
- NetBSD toolchain. 
- Directory storing compiled modules should be cleaned before performing this step
 ```shell
 ./setup.sh -b <path_to_netbsd_src>
 ```
 
## Results
To generate descriptions for a particular device driver(device_driver) run sys2syz.py:
```shell
python sys2syz.py -t <absolute_path_to_device_driver_source> -c compile_commands.json -v
```
This would generate a ```dev_<device_driver>.txt``` file in the ```out``` directory

Example description file generated by sys2syz for i2c device- 
```txt
#Autogenerated by sys2syz
include <i2c_io.h>

resource fd_i2c[fd]

syz_open_dev$I2C(dev ptr[in, string["/dev/i2c"]], id intptr, flags flags[open_flags]) fd_i2c

ioctl$I2C_IOCTL_EXEC(fd fd_i2c, cmd const[I2C_IOCTL_EXEC], arg ptr[out, i2c_ioctl_exec])

i2c_ioctl_exec {
iie_op	flags[i2c_op_t_flags]
iie_addr	int16
iie_buflen	len[iie_buf, intptr]
iie_buf	buffer[out]
iie_cmdlen	len[iie_cmd, intptr]
iie_cmd	buffer[out]
}
```

## Features

- Fetches ioctl calls of a particular device driver.
- Generates a file having syzkaller specific descriptions for fetched ioctl calls.

## TODO

Features yet to be implemented:
- Generation of syzkaller descriptions for syscalls.
- Generation of descriptions for functions, passed as arguments to syscalls.

## References

Blog Post:
- https://blog.netbsd.org/tnf/entry/gsoc_reports_enhancing_syzkaller_support1

This tool is developed by Ayushi Sharma
